{{ define "main" }}
<div class="gallery-grid-container">
    {{ $photos := where .Site.RegularPages "Section" "view" }}
    {{ if gt (len $photos) 0 }}
    <div class="gallery-grid" id="gallery-grid">
        {{ range $photos }}
        <a href="{{ .RelPermalink }}" class="gallery-item">
            <div class="gallery-thumbnail">
                {{ with .Params.image }}
                    {{ $imagePath := . }}
                    {{ if not (hasPrefix $imagePath "/") }}
                        {{ $imagePath = print "/" $imagePath }}
                    {{ end }}
                    {{ $original := resources.Get $imagePath }}
                    {{ if $original }}
                        {{ $thumbnail := $original.Resize "600x jpg q80" }}
                        <img src="{{ $thumbnail.RelPermalink }}" 
                             alt="{{ $.Title }}"
                             width="{{ $thumbnail.Width }}"
                             height="{{ $thumbnail.Height }}"
                             onload="this.classList.add('loaded')"
                             class="gallery-img">
                    {{ else }}
                        <img src="{{ $imagePath }}" 
                             alt="{{ $.Title }}"
                             width="600"
                             height="auto"
                             onload="this.classList.add('loaded')"
                             class="gallery-img">
                    {{ end }}
                {{ end }}
            </div>
        </a>
        {{ end }}
    </div>
    {{ else }}
    <p>No photos available yet.</p>
    {{ end }}
</div>
{{ end }} 