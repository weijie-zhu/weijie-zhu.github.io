{{ define "main" }}
{{ $status := lower (.Params.status | default "") }}
{{ $statusClass := "status-yellow" }}
{{ if in (slice "completed" "done" "shipped" "live") $status }}{{ $statusClass = "status-green" }}{{ end }}
{{ if in (slice "blocked" "stalled" "cancelled" "canceled") $status }}{{ $statusClass = "status-red" }}{{ end }}

{{ $startRaw := .Params.start | default .Params.start_date }}
{{ $endRaw := .Params.end | default .Params.end_date }}
{{ $startText := .Date.Format "Jan 2006" }}
{{ if $startRaw }}{{ $startText = (time $startRaw).Format "Jan 2006" }}{{ end }}
{{ $endText := "" }}
{{ if $endRaw }}
    {{ $endText = (time $endRaw).Format "Jan 2006" }}
{{ else if in (slice "in progress" "active" "maintenance" "ongoing") $status }}
    {{ $endText = "Present" }}
{{ else }}
    {{ $endText = $startText }}
{{ end }}

{{ $keywords := .Params.stack | default (.Params.keywords | default .Params.tags) }}
<div class="post-content project-content">
    <a class="back-link" href="/project/" aria-label="Go back" title="Go back" onclick="if (history.length > 1) { history.back(); return false; }">&#8592;</a>
    <div class="project-single-head">
        <h1 class="post-title project-single-title">
            <span class="project-status-dot {{ $statusClass }}" aria-hidden="true"></span>
            {{ .Title }}
        </h1>
        <div class="project-time-range">{{ $startText }} - {{ $endText }}</div>
    </div>

    <div class="project-list-meta">
        {{ if $keywords }}
            {{ range $keywords }}
            <span class="project-keyword">{{ . }}</span>
            {{ end }}
        {{ end }}
    </div>

    {{ with .Params.cover }}
        {{ $coverPath := . }}
        {{ $cover := resources.Get $coverPath }}
        {{ if $cover }}
            {{ $coverWeb := $cover.Resize "1400x webp q82" }}
            <div class="project-cover">
                <img src="{{ $coverWeb.RelPermalink }}" alt="{{ $.Title }}" width="{{ $coverWeb.Width }}" height="{{ $coverWeb.Height }}" loading="eager" decoding="async">
            </div>
        {{ else }}
            <div class="project-cover">
                <img src="{{ $coverPath | relURL }}" alt="{{ $.Title }}" loading="eager" decoding="async">
            </div>
        {{ end }}
    {{ end }}

    <div class="project-links">
        {{ with .Params.demo }}<a href="{{ . }}" target="_blank" rel="noopener noreferrer">Live Demo</a>{{ end }}
        {{ with .Params.repo }}<a href="{{ . }}" target="_blank" rel="noopener noreferrer">Repository</a>{{ end }}
        {{ with .Params.links }}
            {{ range . }}
                {{ $label := .name | default .label | default "Link" }}
                <a href="{{ .url }}" target="_blank" rel="noopener noreferrer">{{ $label }}</a>
            {{ end }}
        {{ end }}
    </div>

    {{ with .Params.gallery }}
    <div class="project-gallery">
        {{ range . }}
            {{ $path := . }}
            {{ $img := resources.Get $path }}
            {{ if $img }}
                {{ $thumb := $img.Resize "900x webp q80" }}
                <img src="{{ $thumb.RelPermalink }}" alt="{{ $.Title }}" width="{{ $thumb.Width }}" height="{{ $thumb.Height }}" loading="lazy" decoding="async">
            {{ else }}
                <img src="{{ $path | relURL }}" alt="{{ $.Title }}" loading="lazy" decoding="async">
            {{ end }}
        {{ end }}
    </div>
    {{ end }}

    {{ .Content }}
</div>
{{ end }}
